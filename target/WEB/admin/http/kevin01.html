<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/elements.css">
    <title>Document</title>
    <style>
    /* Add your CSS styles here */
    .container-form { container-type: inline-size; margin: 20px; }

    .container-form input,
    .container-form textarea,
    .container-form select {border: 1px solid #ddd; border-radius: 6px; font-family: inherit; font-size: inherit; padding: 8px 12px;}

    .container-form .row { align-items: center; display: flex; gap: 12px; margin-bottom: 16px; }
    .container-form .row:last-child { margin-bottom: 0; } /* to align last item to bottom */

    .container-form .fill {flex: 1;} /* makes select fill available width */
    .container-form .half { flex: 1; max-width: 50%; }

    .container-form .right { justify-content: flex-end; }

    </style>
</head>
<body>

    <div class="container container-form" style="max-width: 800px;">
        <div class="row">
            Name:
            <textarea class="fill" id="idName"></textarea>
        </div>
        <div class="row">
            Value:
            <textarea class="fill" id="idValue"></textarea>
        </div>
        <div class="row right">
            <select class="half" id="idSelect">

            </select>
        </div>
        <div class="row right">
         <button id="idAdd">Add</button>
         <button id="idSave">Save</button>
         <button id="idRemove">Remove</button>
         <button id="idClear">Clear</button>
        </div>
    </div>



    <hr>

    <label id="idSelectText"></label>
    
    

</body>
<script>
    /*function SetText(eText, sKey)
    {
        const sValue = localStorage.getItem(sKey);

        eText.value = sValue;
    }

    function SaveText(eText, sKey)
    {
        let sValue = eText.value;

        localStorage.setItem(sKey, sValue);
    }

    function ChangeLabel(eParent)
    {
        if(!eParent) return;

        const eTextarea = eParent.querySelector("#idTextarea");
        SaveText(eTextarea, "text");
        alert("Clicked");
    }*/

    function AddData(eParent, aData)
    {
        if(!eParent) return;

        aData.push(eParent.value);
        eParent.value = "";
    }

    function UpdateSelect(eParent, sKey, aData)
    {
        if(!eParent) return;

        const aStorageData = JSON.parse(localStorage.getItem(sKey)) || [];
        aData.length = 0;
        aData.push(...aStorageData);

        eParent.innerHTML = "";

        aData.forEach(sValue => {
            const eOption = document.createElement("option");
            eOption.value = sValue;
            eOption.text = sValue;
            eParent.appendChild(eOption);
        });
    }

    function GetValue(eParent)
    {
        if(!eParent) return;

        const sValue = eParent.value;
        return sValue;
    }

    function RemoveValue(aData, value_)
    {
        for(let i = 0; i < aData.length; i++)
        {
            if(aData[i] === value_)
            {
                aData.splice(i, 1);
                return;
            }
        }
    }

    function SetText(eParent, sValue)
    {
        if(!eParent) return;

        eParent.value = sValue;
    }

    function GlobalEventListener(sAction, eSelector, callback_, eParent)
    {
        if(!eParent) return;

        eParent.addEventListener(sAction, (e_) => {
            if(e_.target.matches(eSelector))
            {
                callback_(e_);
            }
        });
    }

    document.addEventListener("DOMContentLoaded", (e_) => {
        const aContainers = document.querySelectorAll(".container");
        //const eTextarea = document.querySelector("#idTextarea");
        //const eLabel = document.querySelector("#idText");
        var aData = [];

        //eLabel.innerHTML = aStoredData;

        //SetText(eTextarea, "text");

        UpdateSelect(document.querySelector("#idSelect"), "data", aData);

        aContainers.forEach((eContainer) => {
            //GlobalEventListener("click", "button", () => ChangeLabel(eContainer), eContainer);
            GlobalEventListener("click", "#idAdd", () => AddData(eContainer.querySelector("#idName"), aData), eContainer);

            GlobalEventListener("click", "#idSave", () => {
                localStorage.setItem("data", JSON.stringify(aData));
                UpdateSelect(eContainer.querySelector("#idSelect"), "data", aData);
            }, eContainer);

            GlobalEventListener("click", "#idClear", () => {localStorage.clear()}, eContainer);
            GlobalEventListener("change", "#idSelect", (e_) => {
                const sValue = GetValue(e_.target);
                SetText(eContainer.querySelector("#idName"), sValue);
            }, eContainer);

            GlobalEventListener("click", "#idRemove", () => {
                const sValue = GetValue(eContainer.querySelector("#idName"));
                RemoveValue(aData, sValue);
                localStorage.setItem("data", JSON.stringify(aData));
                UpdateSelect(eContainer.querySelector("#idSelect"), "data", aData);
            }, eContainer)
        });
    });


</script>
</html>
