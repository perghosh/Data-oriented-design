<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/elements.css">
    <title>Document</title>
</head>
<body>
    <!--<div class="container">
        <div class="form-textarea">
            <textarea id="idTextarea"></textarea>
        </div>
        <div >
            <label id="idLabel"></label>
        </div>
        <button>Click</button>
    </div>

    <hr>
    
    <div class="container">
        <div class="form-textarea">
            <textarea id="idTextarea"></textarea>
        </div>
        <div >
            <label id="idLabel"></label>
        </div>
        <button id="idAdd">Add</button>
        <button id="idSave">Click</button>
    </div>

    <hr>

    <label id="idText"></label>

    <hr>-->

    <div class="container">
        <div>
            Name:
            <textarea id="idName"></textarea>
        </div>
        <div>
            Value:
            <textarea id="idValue"></textarea>
        </div>
        <div>
            <select id="idSelect">

            </select>
        </div>
        <button id="idAdd">Add</button>
        <button id="idSave">Save</button>
        <button id="idRemove">Remove</button>
        <button id="idClear">Clear</button>
    </div>



    <hr>

    <label id="idSelectText"></label>

</body>
<script>
    /*function SetText(eText, sKey)
    {
        const sValue = localStorage.getItem(sKey);

        eText.value = sValue;
    }

    function SaveText(eText, sKey)
    {
        let sValue = eText.value;

        localStorage.setItem(sKey, sValue);
    }

    function ChangeLabel(eParent)
    {
        if(!eParent) return;
        
        const eTextarea = eParent.querySelector("#idTextarea");
        SaveText(eTextarea, "text");
        alert("Clicked");
    }*/

    function AddData(eParent, aData)
    {
        if(!eParent) return;

        aData.push(eParent.value);
        eParent.value = "";
    }

    function UpdateSelect(eParent, sKey, aData)
    {
        if(!eParent) return;
        
        const aStorageData = JSON.parse(localStorage.getItem(sKey)) || [];
        aData.length = 0;
        aData.push(...aStorageData);

        eParent.innerHTML = "";

        aData.forEach(sValue => {
            const eOption = document.createElement("option");
            eOption.value = sValue;
            eOption.text = sValue;
            eParent.appendChild(eOption);
        });
    }

    function GetValue(eParent)
    {
        if(!eParent) return;

        const sValue = eParent.value;
        return sValue;
    }

    function RemoveValue(aData, value_)
    {
        for(let i = 0; i < aData.length; i++)
        {
            if(aData[i] === value_)
            {
                aData.splice(i, 1);
                return;
            }
        }   
    }

    function SetText(eParent, sValue)
    {
        if(!eParent) return;

        eParent.value = sValue;
    }

    function GlobalEventListener(sAction, eSelector, callback_, eParent)
    {
        if(!eParent) return;

        eParent.addEventListener(sAction, (e_) => {
            if(e_.target.matches(eSelector))
            {
                callback_(e_);
            }       
        });
    }

    document.addEventListener("DOMContentLoaded", (e_) => {
        const aContainers = document.querySelectorAll(".container");
        //const eTextarea = document.querySelector("#idTextarea");
        //const eLabel = document.querySelector("#idText");
        var aData = [];

        //eLabel.innerHTML = aStoredData;

        //SetText(eTextarea, "text");

        UpdateSelect(document.querySelector("#idSelect"), "data", aData);

        aContainers.forEach((eContainer) => {
            //GlobalEventListener("click", "button", () => ChangeLabel(eContainer), eContainer);
            GlobalEventListener("click", "#idAdd", () => AddData(eContainer.querySelector("#idName"), aData), eContainer);

            GlobalEventListener("click", "#idSave", () => {
                localStorage.setItem("data", JSON.stringify(aData));
                UpdateSelect(eContainer.querySelector("#idSelect"), "data", aData);
            }, eContainer);

            GlobalEventListener("click", "#idClear", () => {localStorage.clear()}, eContainer);
            GlobalEventListener("change", "#idSelect", (e_) => {
                const sValue = GetValue(e_.target);
                SetText(eContainer.querySelector("#idName"), sValue);
            }, eContainer);

            GlobalEventListener("click", "#idRemove", () => {
                const sValue = GetValue(eContainer.querySelector("#idName"));
                RemoveValue(aData, sValue);
                localStorage.setItem("data", JSON.stringify(aData));
                UpdateSelect(eContainer.querySelector("#idSelect"), "data", aData);
            }, eContainer)
        });
    });

    
</script>
</html>