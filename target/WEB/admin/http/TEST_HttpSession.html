<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="css/elements.css">
   <title>Test session logic in http web server</title>
   <style>
      .movable { background-color: #f0f0f0; border: 2px solid #ccc; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); cursor: move; opacity: 1; padding: 20px; transition: box-shadow 0.3s ease; user-select: none; width: 200px; }

      .movable.dragging { box-shadow: 0 8px 16px rgba(0,0,0,0.2); opacity: 0.8; }

      .movable:hover { box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
   </style>
   <script>
      /**
       * Class to make HTML elements draggable
       */
      class DraggableElement {
         /**
          * @param {HTMLElement} element - The element to make draggable
          * @param {Object} options - Configuration options
          * @param {boolean} options.bUseTransform - Use transform property instead of position
          * @param {string} options.handleSelector - CSS selector for drag handle (optional)
          */
         constructor(element, options = {}) {
            this.element = element;
            this.oOptions = Object.assign({  bUseTransform: true, handleSelector: null }, options);

            this.bIsDragging = false;
            this.iInitialX = 0;
            this.iInitialY = 0;
            this.iCurrentX = 0;
            this.iCurrentY = 0;
            this.iXOffset = 0;
            this.iYOffset = 0;

            this.dragHandle = this.oOptions.handleSelector
               ? element.querySelector(this.oOptions.handleSelector)
               : element;

            this.oBoundHandlers = {
                mouse_down: this.OnMouseDown.bind(this),
                mouse_move: this.OnMouseMove.bind(this),
                mouse_up: this.OnMouseUp.bind(this),
                touch_start: this.OnTouchStart.bind(this),
                touch_move: this.OnTouchMove.bind(this),
                touch_end: this.OnTouchEnd.bind(this)
            };

            this.#initialize();
         }

         /** ------------------------------------------------------------------
          * Initialize event listeners
          */
         #initialize() {
            this.dragHandle.addEventListener('mousedown', this.oBoundHandlers.mouse_down);
            document.addEventListener('mousemove', this.oBoundHandlers.mouse_move);
            document.addEventListener('mouseup', this.oBoundHandlers.mouse_up);

            // Touch events for mobile support
            this.dragHandle.addEventListener('touchstart', this.oBoundHandlers.touch_start);
            document.addEventListener('touchmove', this.oBoundHandlers.touch_move);
            document.addEventListener('touchend', this.oBoundHandlers.touch_end);
         }

         /** ------------------------------------------------------------------
          * Get initial position and set dragging state
          * @param {MouseEvent} e - Mouse event
          */
         OnMouseDown(e_) {
            this.iInitialX = e_.clientX - this.iXOffset;
            this.iInitialY = e_.clientY - this.iYOffset;

            if(e_.target === this.dragHandle || this.dragHandle.contains(e_.target)) { this.bIsDragging = true; }
         }

         /** ------------------------------------------------------------------
          * Handle mouse move event
          * @param {MouseEvent} e - Mouse event
          */
         OnMouseMove(e_) {
            if(this.bIsDragging) {
               e_.preventDefault();
               this.iCurrentX = e_.clientX - this.iInitialX;
               this.iCurrentY = e_.clientY - this.iInitialY;

               this.iXOffset = this.iCurrentX;
               this.iYOffset = this.iCurrentY;

               this.SetPosition(this.iCurrentX, this.iCurrentY);
            }
         }

         /** ------------------------------------------------------------------
          * Reset dragging state on mouse up
          */
         OnMouseUp() {
            this.iInitialX = this.iCurrentX;
            this.iInitialY = this.iCurrentY;
            this.bIsDragging = false;
         }

         /**
          * Handle touch start event
          * @param {TouchEvent} e - Touch event
          */
         OnTouchStart(e_) {
            const oTouch = e_.touches[0];
            const oMouseEvent = new MouseEvent('mousedown', {
               clientX: oTouch.clientX,
               clientY: oTouch.clientY
            });
            this.dragHandle.dispatchEvent(oMouseEvent);
         }

         /** ------------------------------------------------------------------
          * Handle touch move event
          * @param {TouchEvent} e_ - Touch event
          */
         OnTouchMove(e_) {
            const oTouch = e_.touches[0];
            const oMouseEvent = new MouseEvent('mousemove', {
               clientX: oTouch.clientX,
               clientY: oTouch.clientY
            });
            document.dispatchEvent(oMouseEvent);
         }

         /** ------------------------------------------------------------------
          * Handle touch end event
          * @param {TouchEvent} e_ - Touch event
          */
         OnTouchEnd(e_) {
            const oMouseEvent = new MouseEvent('mouseup', {});
            document.dispatchEvent(oMouseEvent);
         }

         /** ------------------------------------------------------------------
          * Set the element position
          * @param {number} iX - X position
          * @param {number} iY - Y position
          */
         SetPosition(iX, iY) {
            const oStyle = this.element.style;
            if(this.oOptions.bUseTransform) {  oStyle.transform = `translate3d(${iX}px, ${iY}px, 0)`; }
            else {
               oStyle.position = 'absolute';
               oStyle.left = `${iX}px`;
               oStyle.top = `${iY}px`;
            }
         }

         /** ------------------------------------------------------------------
          * Reset the element position to 0,0
          */
         ResetPosition() {
            this.iCurrentX = 0;
            this.iCurrentY = 0;
            this.iXOffset = 0;
            this.iYOffset = 0;
            this.SetPosition(0, 0);
         }

         /** ------------------------------------------------------------------
          * Destroy the draggable instance and remove event listeners
          */
         Destroy() {
            this.dragHandle.removeEventListener('mousedown', this.oBoundHandlers.mouse_down);
            document.removeEventListener('mousemove', this.oBoundHandlers.mouse_move);
            document.removeEventListener('mouseup', this.oBoundHandlers.mouse_up);

            this.dragHandle.removeEventListener('touchstart', this.oBoundHandlers.touch_start);
            document.removeEventListener('touchmove', this.oBoundHandlers.touch_move);
            document.removeEventListener('touchend', this.oBoundHandlers.touch_end);
         }
      }
   </script>
</head>
<body>
   <h1>HTTP Sess</script>ion Test Page</h1>
   <p>This page is used to test HTTP session management in the web server.</p>
   <div class="container" style="max-width: 800px;">
      <div id="movableObject" class="movable">movable object</div>
   </div>
   <script>
      document.addEventListener('DOMContentLoaded', function() {
         const movableElement = document.getElementById('movableObject');
         const draggable = new DraggableElement(movableElement);

         // Add visual feedback when dragging
         movableElement.addEventListener('mousedown', function() {
            this.classList.add('dragging');
         });

         movableElement.addEventListener('mouseup', function() {
            this.classList.remove('dragging');
         });
      });
   </script>
</body>
</html>
