<!--
PAGE_ Method Documentation:
=========================

PAGE_OnIdle - Handles idle state by updating UI elements and checking for changes

-->


<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link id="idCssVariable" rel="stylesheet" href="variables-default.css">
   <script src="js/classes/gd_data_form.js"></script>
   <script src="js/classes/gd_data_table.js"></script>
   <title>Document</title>
   <style>
      
      body { font-family: Arial, Helvetica, sans-serif;}

      .container-form {}

      .container-form .form {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-primary);

         margin: auto;
         margin-top: 50px;

         padding: 25px;
         width: 25%;
      }

      .container-form label {display: block; padding: 10px 0px 5px 0px;}  

      .container-form input { 
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-secondary);

         padding: 5px;
         width: 95%;
      }

      .container-form input[type=number] {width: 10%;}

      /*---------------------------------------------------------------------*/

      .container-form2 {}

            
      .container-form2 .form {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-primary);

         display: flex;
         flex-wrap: wrap;
         row-gap: 15px;

         margin: auto;
         margin-top: 50px;

         padding: 25px;
         width: 25%;

         transition: background-color 0.3s ease;
      }

      .container-form2 label {flex: 0 0 30%; padding: 10px 0px 5px 0px;}  

      .container-form2 input { 
         border-style: none;
         border-radius: 10px;
         box-sizing: border-box;
         background-color: var(--background-secondary);

         flex: 0 0 70%;

         padding: 5px;
         /*width: 80%;*/

         transition: background-color 0.3s ease;
      }

      .container-form2 input[type=number] {flex: 0 0 70%; }

      /*---------------------------------------------------------------------*/

      .container-label {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-primary);

         margin: auto;
         margin-top: 25px;

         padding: 25px;
         width: 25%;

         transition: background-color 0.3s ease;
      }

      .container-button {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-primary);

         margin: auto;
         margin-top: 15px;

         padding: 25px;
         width: 25%;

         transition: background-color 0.3s ease;
      }

      .container-button button {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-secondary);

         padding: 10px 25px 10px 25px;

         transition: background-color 0.3s ease;
      }

      .container-button button:hover {
         background-color: var(--background-success);
      }

   </style>
</head>
<body>
   <div id="idContainer" class="container-form2">

   </div>

   <div class="container-button" id="idContainerButton">
      <button data-field="save">Submit</button>
      <button data-field="delete">Remove</button>
   </div>

   <div class="container-label">
      <h2 id="idText"></h2>
   </div>

   <div class="container-label" data-type="group">
      <select id="idSelectTheme" onchange="ChangeTheme()">
         <option value="variables-candy-light.css">Candy light</option>
         <option value="variables-corporate-blue.css">Corporate Blue</option>
         <option value="variables-purple-soft.css">Purple soft</option>
         <option value="variables-red-black.css">Red black</option>
         <option value="variables-royal-violet.css">Royal violet</option>
         <option value="variables-compular.css">Compular</option>
         <option value="variables-grey.css">Grey</option>
         <option value="variables-soft-candy.css">Soft candy</option>
         <option value="variables-green-food.css">Green food</option>
         <option value="variables-midnight-gold.css">Midnight gold</option>
         <option value="variables-modern-emerald.css">Modern emerald</option>
      </select>
   </div>


<script>
   const oForm = new Form([
        { sId: "name", sLabel: "Full Name", sType: "string", bRequired: true, iMinLength: 2 },
        { sId: "age", sLabel: "Age", sType: "number", nMin: 18, nMax: 100 },
        { sId: "email", sLabel: "Email", sType: "string", pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
    ]);

    let table = new Table(["name", "age", "email"]);

   let bModified_g = false;
   let iIdleTimerId_g = null;
   let oDocument_g;   // Global document object

   function GlobalEventListener(sAction, eSelector, callback_, eParent)
   {
      if(!eParent) return;

      eParent.addEventListener(sAction, (e_) => {
         if(e_.target.matches(eSelector))
         {
               callback_(e_);
         }
      });
   }

   function ChangeTheme() {
      const sTheme = document.getElementById('idSelectTheme').value;
      if(sTheme) { document.getElementById('idCssVariable').href = "css/" + sTheme; }
   }

    //const data = form.GetField(0);
    //console.log(data);

   function CreateForm(parent_)
   {
      //if(!parent_) {parent_ = "#idContainer"}

      //if( parent_ === "#idContainer")
      //{
         let eParent = document.querySelector(parent_);
         if(!eParent) {eParent = document.getElementById(parent_)}

         let eForm = document.createElement("form");
         eForm.classList.add("form");

         const iFieldCount = oForm.Size();
         for(let i = 0; i < iFieldCount; i++)
         {
            const oField = oForm.GetField(i);
            const eField = document.createElement("input");
         
            const eLabel = document.createElement("label");

            eField.type = oField.sType;
            eField.id = oField.sId;
            eField.placeholder = oField.sLabel;
            eField.required = oField.bRequired;

            eField.dataset.field = eField.id; // data-field="<id>"
         
            eLabel.textContent = oField.sLabel;

            eForm.appendChild(eLabel);
            eForm.appendChild(eField);
         }

         eParent.appendChild(eForm);
      //}
   }

   /**
    * Collect all input entries
    */
   function CollectInputEntries(parent_)
   {
      let aData = [];

      let eParent = document.querySelector(parent_);
      if(!eParent) {eParent = document.getElementById(parent_)}  

      const eInputs = eParent.querySelectorAll("input");

      eInputs.forEach(eInput => {
         const value_ = eInput.value;

         aData.push(value_);

      });

      return aData;
   }

   /**
    * Delete all input entries
    */
   function RemoveInputEntries(parent_)
   {
      let eParent = document.querySelector(parent_);
      if(!eParent) {eParent = document.getElementById(parent_)}  

      const eInputs = eParent.querySelectorAll("input");

      eInputs.forEach(eInput => {
         eInput.value = "";
      });
   }

   function PAGE_ConfigureListeners() {
      const eContainer = document.getElementById("idContainer");
      eContainer.addEventListener("input",(e_) => {
         const eTarget = e_.target;
         const sField = eTarget.dataset.field; 
         if( !sField ) { return; }

         e_.stopPropagation();                                                                     console.log( "Id for field ", sField );

         oDocument_g.SetModified(true);

      });
   }

   /** ---------------------------------------------------------------------
    * Set listener for click event
    */
   function PAGE_SetListener()
   {
      const eContainer = document.getElementById("idContainerButton");
      eContainer.addEventListener("click",(e_) => {
         const eTarget = e_.target;
         const sField = eTarget.dataset.field;

         e_.stopPropagation();                                                                     console.log( "Id for button ", sField);

         switch(sField)
         {
            case "save":
               const aData = CollectInputEntries("#idContainer");
               RemoveInputEntries("#idContainer");

               oDocument_g.SetModified(false);
               table.Add(aData);
               console.log(table.GetData());

               break;

            case "delete": 
               RemoveInputEntries("#idContainer");

               oDocument_g.SetModified(false);
               
               break;
         }

         //oDocument_g.SetModified(true);

      });
   }

   /** --------------------------------------------------------------------- @API [tag: initialize]
    * Main initialization function that initializes the page
    */
   function PAGE_Initialize() {
      oDocument_g = new CDocument({});

      // ## Start idle timer - call PAGE_OnIdle() once per second
      CDocument.iIdleTimerId_s = setInterval(PAGE_OnIdle, 1000);

      CreateForm("#idContainer");

      PAGE_ConfigureListeners();
               // ## Start idle timer - call PAGE_OnIdle() once per second
      //iIdleTimerId_g = setInterval(PAGE_OnIdle, 1000);

      PAGE_SetListener();

      /*GlobalEventListener("click", "#idSave", () =>
         {
            const aData = CollectInputEntries("#idContainer");
            oDocument_g.SetModified(false);
            table.Add(aData);
            console.log(table.GetData());
         },
         document
      )*/
   }

   /** --------------------------------------------------------------------- @API [tag: onidle]
    * Handles idle state by updating UI elements and checking for changes
    */
   const PAGE_OnIdle = (function() {
      var bLastModified = false;

      return function() {
         const bModified = oDocument_g.IsModified();

         if( bModified !== bLastModified ) {

            // TODO: Update UI elements based on modified status

            let eText = document.querySelector("#idText");
            if(bModified == true)
            {
               eText.textContent = "Modified";  
            }
            else
            {
               eText.textContent = "";
            }

            bLastModified = bModified;
         }
      }
   })();

   document.addEventListener('DOMContentLoaded', function() {

      PAGE_Initialize();


   });

   class CDocument {

      static iIdleTimerId_s = null; // Global timer ID for idle callback

      constructor( oOptions = {} ) {
         this.bModified = false; // Initialize modified flag to false
      }

      // Check if document has been modified ------------------------------
      IsModified() { return this.bModified; }
      // Set modified flag to true or false -------------------------------
      SetModified(bModified) { this.bModified = bModified; }

   }

</script>
</body>
</html>
