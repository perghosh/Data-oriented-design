<!--
PAGE_ Method Documentation:
=========================

PAGE_OnIdle - Handles idle state by updating UI elements and checking for changes

-->


<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link id="idCssVariable" rel="stylesheet" href="variables-default.css">
   <script src="js/classes/gd_data_form.js"></script>
   <script src="js/classes/gd_data_table.js"></script>
   <title>Document</title>
   <style>
      
      body { font-family: Arial, Helvetica, sans-serif;}

      .container-form {}

      .container-form .form {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-primary);

         margin: auto;
         margin-top: 50px;

         padding: 25px;
         width: 25%;
      }

      .container-form label {display: block; padding: 10px 0px 5px 0px;}  

      .container-form input { 
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-secondary);

         padding: 5px;
         width: 95%;
      }

      .container-form input[type=number] {width: 10%;}

      /*---------------------------------------------------------------------*/

      .container-form2 {}

            
      .container-form2 .form {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-primary);

         display: flex;
         flex-wrap: wrap;
         row-gap: 15px;

         margin: auto;
         margin-top: 50px;

         padding: 25px;
         width: 25%;

         transition: background-color 0.3s ease;
      }

      .container-form2 label {flex: 0 0 30%; padding: 10px 0px 5px 0px;}  

      .container-form2 input { 
         border-style: none;
         border-radius: 10px;
         box-sizing: border-box;
         background-color: var(--background-secondary);

         flex: 0 0 70%;

         padding: 5px;
         /*width: 80%;*/

         transition: background-color 0.3s ease;
      }

      .container-form2 input[type=number] {flex: 0 0 70%; }

      /*---------------------------------------------------------------------*/

      .container-label {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-primary);

         margin: auto;
         margin-top: 25px;

         padding: 25px;
         width: 25%;

         transition: background-color 0.3s ease;
      }

      .container-button {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-primary);

         margin: auto;
         margin-top: 15px;

         padding: 25px;
         width: 25%;

         transition: background-color 0.3s ease;
      }

      .container-button button {
         border-style: none;
         border-radius: 10px;
         background-color: var(--background-secondary);

         padding: 10px 25px 10px 25px;

         transition: background-color 0.3s ease;
      }

      .container-button button:hover {
         background-color: var(--background-success);
      }

   </style>
</head>
<body>
   <div id="idContainer" class="container-form2">

   </div>

   <div class="container-button" ><button id="idSave">Submit</button></div>

   <div class="container-label" data-type="group">
      <select id="idSelectTheme" onchange="ChangeTheme()">
         <option value="variables-candy-light.css">Candy light</option>
         <option value="variables-corporate-blue.css">Corporate Blue</option>
         <option value="variables-purple-soft.css">Purple soft</option>
         <option value="variables-red-black.css">Red black</option>
         <option value="variables-royal-violet.css">Royal violet</option>
         <option value="variables-compular.css">Compular</option>
         <option value="variables-grey.css">Grey</option>
         <option value="variables-soft-candy.css">Soft candy</option>
         <option value="variables-green-food.css">Green food</option>
         <option value="variables-midnight-gold.css">Midnight gold</option>
         <option value="variables-modern-emerald.css">Modern emerald</option>
      </select>
   </div>

   <div></div>
<script>
   const oForm = new Form([
        { sId: "name", sLabel: "Full Name", sType: "string", bRequired: true, iMinLength: 2 },
        { sId: "age", sLabel: "Age", sType: "number", nMin: 18, nMax: 100 },
        { sId: "email", sLabel: "Email", sType: "string", pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
    ]);

    let bModified_g = false;
    let iIdleTimerId_g = null;

   function GlobalEventListener(sAction, eSelector, callback_, eParent)
   {
      if(!eParent) return;

      eParent.addEventListener(sAction, (e_) => {
         if(e_.target.matches(eSelector))
         {
               callback_(e_);
         }
      });
   }

   function ChangeTheme() {
      const sTheme = document.getElementById('idSelectTheme').value;
      if(sTheme) { document.getElementById('idCssVariable').href = "css/" + sTheme; }
   }

    //const data = form.GetField(0);
    //console.log(data);

   function CreateForm(parent_)
   {
      //if(!parent_) {parent_ = "#idContainer"}

      //if( parent_ === "#idContainer")
      //{
         let eParent = document.querySelector(parent_);
         if(!eParent) {eParent = document.getElementById(parent_)}

         let eForm = document.createElement("form");
         eForm.classList.add("form");

         const iFieldCount = oForm.Size();
         for(let i = 0; i < iFieldCount; i++)
         {
            const oField = oForm.GetField(i);
            const eField = document.createElement("input");
         
            const eLabel = document.createElement("label");

            eField.type = oField.sType;
            eField.id = oField.sId;
            eField.placeholder = oField.sLabel;
            eField.required = oField.bRequired;

            eField.dataset.field = eField.id; // data-field="<id>"
         
            eLabel.textContent = oField.sLabel;

            eForm.appendChild(eLabel);
            eForm.appendChild(eField);
         }

         eParent.appendChild(eForm);
      //}
   }

   function CollectInputEntries(parent_)
   {
      let aData = [];

      let eParent = document.querySelector(parent_);
      if(!eParent) {eParent = document.getElementById(parent_)}  

      const eInputs = eParent.querySelectorAll("input");

      eInputs.forEach(eInput => {
         const sKey = eInput.id;
         const value_ = eInput.value;

         aData.push({sKey, value_});

      });

      return aData;
   }

   function PAGE_ConfigureListeners() {
      const eContainer = document.getElementById("idContainer");
      eContainer.addEventListener("input",(e_) => {
         const eTarget = e_.target;
         const sField = eTarget.dataset.field; 
         if( !sField ) { return; }

         e_.stopPropagation();                                                                     console.log( "Id for field ", sField );

         bModified_g = true;

      });
   }

   function PAGE_OnIdle() {
      console.log( "OnIdle: modified = ", bModified_g )
   }

   document.addEventListener('DOMContentLoaded', function() {
      CreateForm("#idContainer");

      PAGE_ConfigureListeners();
               // ## Start idle timer - call PAGE_OnIdle() once per second
      iIdleTimerId_g = setInterval(PAGE_OnIdle, 1000);



      GlobalEventListener("click", "#idSave", () =>
         {
            const aData = CollectInputEntries("#idContainer");
            bModified_g = false;
            console.log(aData);
         },
         document
      )
   });

</script>
</body>
</html>
